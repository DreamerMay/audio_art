import { generateUniqueNumber } from 'fast-unique-numbers';
import { renderUnknownPortIdError } from './error-renderers';
const DESTROY_WORKER_FUNCTIONS = new Map();
export const extendWorkerImplementation = (createWorker, partialWorkerImplementation) => {
    return Object.assign({}, partialWorkerImplementation, { connect: ({ port }) => {
            port.start();
            const destroyWorker = createWorker(port, partialWorkerImplementation);
            const portId = generateUniqueNumber(DESTROY_WORKER_FUNCTIONS);
            DESTROY_WORKER_FUNCTIONS.set(portId, () => {
                destroyWorker();
                port.close();
                DESTROY_WORKER_FUNCTIONS.delete(portId);
            });
            return { result: portId };
        }, disconnect: ({ portId }) => {
            const destroyWorker = DESTROY_WORKER_FUNCTIONS.get(portId);
            if (destroyWorker === undefined) {
                throw renderUnknownPortIdError({ portId: portId.toString() });
            }
            destroyWorker();
            return { result: null };
        } });
};
//# sourceMappingURL=/build/es2015/helpers/extend-worker-implementation.js.map