// tslint:disable-next-line:max-line-length
export const worker = `!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeTempoBuckets=void 0;var o=r(3),n=r(4),s=r(5),a=r(6);t.computeTempoBuckets=((e,t)=>{const r=(0,n.getMaximumValue)(e),u=.3*r;let c=[],l=r-.05*r;if(r>.25)for(;c.length<30&&l>=u;)c=(0,s.getPeaksAtThreshold)(e,l,t),l-=.05*r;const i=(0,o.countIntervalsBetweenNearbyPeaks)(c),p=(0,a.groupNeighborsByTempo)(i,t);return p.sort((e,t)=>t.score-e.score),p})},function(e,t,r){"use strict";var o=r(2),n=r(7);addEventListener("message",({data:e})=>{try{if("analyze"===e.method){const r=e.id;var t=e.params;const n=t.channelData,s=t.sampleRate,a=(0,o.analyze)(n,s);postMessage({error:null,id:r,result:{tempo:a}})}else{if("guess"!==e.method)throw new Error('The given method "'+e.method+'" is not supported');{const t=e.id;var r=e.params;const o=r.channelData,a=r.sampleRate;var s=(0,n.guess)(o,a);const u=s.bpm,c=s.offset;postMessage({error:null,id:t,result:{bpm:u,offset:c}})}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.analyze=void 0;var o=r(0);t.analyze=((e,t)=>{const r=(0,o.computeTempoBuckets)(e,t);if(0===r.length)throw new Error("The given channelData does not contain any detectable beats.");return r[0].tempo})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.countIntervalsBetweenNearbyPeaks=(e=>{const t=[];return e.forEach((r,o)=>{const n=Math.min(e.length-o,10);for(let s=1;s<n;s+=1){const n=e[o+s]-r;t.some(e=>e.interval===n&&(e.peaks.push(r),!0))||t.push({interval:n,peaks:[r]})}}),t})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getMaximumValue=(e=>{let t=0;const r=e.length;for(let o=0;o<r;o+=1)e[o]>t&&(t=e[o]);return t})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getPeaksAtThreshold=((e,t,r)=>{const o=e.length,n=[];let s=!1;for(let a=0;a<o;a+=1)e[a]>t?s=!0:s&&(s=!1,n.push(a-1),a+=r/4-1);return s&&n.push(o-1),n})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.groupNeighborsByTempo=((e,t)=>{const r=[];return e.forEach(e=>{let o=60/(e.interval/t);for(;o<90;)o*=2;for(;o>180;)o/=2;let n=!1,s=e.peaks.length;r.forEach(t=>{if(t.tempo===o&&(t.score+=e.peaks.length,t.peaks=[...t.peaks,...e.peaks],n=!0),t.tempo>o-.5&&t.tempo<o+.5){const r=2*Math.abs(t.tempo-o);s+=(1-r)*t.peaks.length,t.score+=(1-r)*e.peaks.length}}),n||r.push({peaks:e.peaks,score:s,tempo:o})}),r})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guess=void 0;var o=r(0);t.guess=((e,t)=>{const r=(0,o.computeTempoBuckets)(e,t);if(0===r.length)throw new Error("The given channelData does not contain any detectable beats.");var n=r[0];const s=n.peaks,a=n.tempo,u=Math.round(a),c=60/u;s.sort((e,t)=>e-t);let l=s[0]/t;for(;l>c;)l-=c;return{bpm:u,offset:l}})}]);`;
